<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta charset="utf-8" />
    <title>BUAAQuant</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="media/css/style-metro.css" rel="stylesheet" type="text/css" />
    <link href="media/css/style.css" rel="stylesheet" type="text/css" />
    <link href="media/css/style-responsive.css" rel="stylesheet" type="text/css" />
    <link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="media/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel="shortcut icon" href="media/image/favicon.ico" />
    <script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
    <script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
    <script src="js/savePython.js" type="text/javascript"></script>
    <!-- <script src="edit.js" type="text/javascript"></script> -->
    <script type="text/javascript">
    function getByteLen(e) {
        var b = 0;
        for (var d = 0; d < e.length; d++) {
            var c = e.charAt(d);
            if (c.match(/[^\x00-\xff]/ig) != null) {
                b += 2
            } else {
                b += 1
            }
        }
        return b
    }
    jQuery(function($) {
        $(".algo-title").click(function(b) {
            console.log("xxxxx");
            b.stopPropagation();
            $(this).addClass("hidden");
            $(".algo-title-box").removeClass("hidden").focus().val($(".algo-title").html());
            var a = getByteLen($("#title-box").val());
            $("#title-box").width(a * 8 + "px").css({
                padding: 10,
                "min-width": 390,
                "max-width": 1280
            })
        });
        $("#title-box").keydown(function() {
            var a = getByteLen($("#title-box").val());
            $("#title-box").width(a * 8 + "px").css({
                padding: 10,
                "min-width": 390,
                "max-width": 1280
            })
        });
        $("#title-box").blur(function() {
            $(".algo-title-box").addClass("hidden");
            var a = this;
            if ($(this).val() != "") {
                $(".algo-title").html($(a).val())
            }
            $(".algo-title").removeClass("hidden");
            $(document).attr("title", $(this).val());
            // unsave()
        });

    });
    </script>
    <style type="text/css">
    input.hidden {
        display: none;
    }
    </style>

    <style type="text/css">
        
    </style>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->

<body class="page-header-fixed">
    <!-- BEGIN HEADER -->
    <div class="header navbar navbar-inverse navbar-fixed-top">
        <!-- BEGIN TOP NAVIGATION BAR -->
        <div class="navbar-inner">
            <div class="container-fluid">
                <!-- BEGIN LOGO -->
                <a class="brand" href="index.php">
                    <!-- <img src="media/image/logo.png" alt="logo" /> -->
                    <img src="media/image/BUAAQuant.png" alt="logo" />
                </a>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
                    <img src="media/image/menu-toggler.png" alt="" />
                </a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU -->
                <ul class="nav pull-right">
                    <li class="active"><a href="index.html"><i class="icon-cogs"></i><span>我的策略</span> </a> </li>
                    <li><a href="reports.html"><i class="icon-list-alt"></i><span>帮助</span> </a> </li>
                    <li><a href="guidely.html"><i class="icon-coffee"></i><span>智能投顾</span> </a></li>
                    <li><a href="charts.html"><i class="icon-comments"></i><span>社区</span> </a> </li>
                    <li><a href="shortcodes.html"><i class="icon-code"></i><span>Shortcodes</span> </a> </li>
                    <li class="dropdown">
                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown"> <i class="icon-long-arrow-down"></i><span>Drops</span> <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="icons.html">Icons</a></li>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="pricing.html">Pricing Plans</a></li>
                            <li><a href="login.html">Login</a></li>
                            <li><a href="signup.html">Signup</a></li>
                            <li><a href="error.html">404</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i
                            class="icon-cog"></i> 账户 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="javascript:;">设置</a></li>
                            <li><a href="javascript:;">帮助</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i
                            class="icon-user"></i> 某某某 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="javascript:;">个人信息</a></li>
                            <li><a href="javascript:;">登出</a></li>
                        </ul>
                    </li>
                </ul>
                <!-- END TOP NAVIGATION MENU -->
            </div>
        </div>
        <!-- END TOP NAVIGATION BAR -->
    </div>
    <!-- END HEADER -->
    <!-- BEGIN CONTAINER -->
    <div class="page-container row-fluid">
        <!-- BEGIN SIDEBAR -->
        <!-- END SIDEBAR -->
        <!-- BEGIN PAGE -->
        <div class="" style="background: #ffffff">
            <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <!-- <div id="portlet-config" class="modal hide">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"></button>
                    <h3>portlet Settings</h3>
                </div>
                <div class="modal-body">
                    <p>Here will be a configuration form</p>
                </div>
            </div> -->
            <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <!-- BEGIN PAGE CONTAINER-->
            <div class="container-fluid">
                <!-- BEGIN PAGE HEADER-->
                <div class="row-fluid">
                    <div class="span12">
                        <ul class="breadcrumb">
                            <li>
                                <i class="icon-home"></i>
                                <a href="index.html">首页</a>
                                <i class="icon-angle-right"></i>
                            </li>
                            <li><a href="#">策略</a></li>
                        </ul>
                        <!-- END PAGE TITLE & BREADCRUMB-->
                    </div>
                </div>
                <div class="span6 pull-left" style="width: 44.5%;">
                    <!-- BEGIN TAB PORTLET-->
                    <div class="portlet box blue tabbable">
                        <div class="portlet-title">
                            <div class="caption"><i class="icon-reorder"></i>帮助</div>
                        </div>
                        <div class="portlet-body" >
                            <div class="tabbable portlet-tabs" style="height: 590px">
                                <ul class="nav nav-tabs">
                                    <li><a href="#portlet_tab2_3" data-toggle="tab">智能策略实例</a></li>
                                    <li><a href="#portlet_tab2_2" data-toggle="tab">我的收藏</a></li>
                                    <li class="active"><a href="#portlet_tab2_1" data-toggle="tab">API文档</a></li>
                                </ul>
                                <div class="tab-content" style="height: 508px; overflow: auto;">
                                    <div class="tab-pane active" id="portlet_tab2_1">
                                        <div class=""">
                                            <h1 class='infoType'>查询与计算</h1>
                                            <div id='query'>
                                                <div id=''>
                                                    <text class='infoHead'>历史数据</text>
                                                    <br />
                                                    <text class='infoCode'><b>attribute_history(stock_name, count, unit='1d')</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        查询结果不为空时，返回DataFrame格式的表；查询结果为空时返回None
                                                        <br /> stock_name为股票编号
                                                        <br /> count为返回记录条数
                                                        <br /> unit=’跨度+细度’对返回内容筛选。
                                                        <br /> 跨度表示间隔多少单位取值，是整数值；
                                                        <br /> 细度表示返回的表是分钟级还是天级(取当天9:31的值)。
                                                        <br /> e.g. unit=’5d’，将返回每隔5天的count条记录
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>总价值</text>
                                                    <br />
                                                    <text class='infoCode'><b>totalValue()</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        返回当前时刻账户持有的总价值
                                                        <br /> 总金钱=各仓位股票当前时刻的价值之和+现金
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>基准价值</text>
                                                    <br />
                                                    <text class='infoCode'><b>benchmarkValue()</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        返回当前时刻账户的基准的总价值，即基准持股当前时刻价值+基准剩余现金
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>策略收益</text>
                                                    <br />
                                                    <text class='infoCode'><b>totalReturns()</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        返回当前时刻账户策略的收益
                                                        <br /> =(总价值-初始现金)/初始现金
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>基准收益</text>
                                                    <br />
                                                    <text class='infoCode'><b>benchmarkReturns()</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        返回当前时刻账户基准的收益
                                                        <br /> =(基准价值-初始现金)/初始现金
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>策略年化收益</text>
                                                    <br />
                                                    <text class='infoCode'><b>totalAnnualizedReturns()</b>
                                                        <br />
                                                    </text>
                                                    <text>设回测天数为d
                                                        <br /> =(策略收益+1)^(250/d)-1
                                                        <br />
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>基准年化收益</text>
                                                    <br />
                                                    <text class='infoCode'><b>benchmarkAnnualizedReturns()</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        设回测天数为d
                                                        <br /> =(基准收益+1)^(250/d)-1
                                                    </text>
                                                </div>
                                                <br />
                                            </div>
                                            <br />
                                            <h1 class='infoType'>设置初始值</h1>
                                            <div id='set'>
                                                <div id=''>
                                                    <text class='infoHead'>设置股票池</text>
                                                    <br />
                                                    <text class='infoCode'><b>set_universe(universe)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        universe为字符串字典，各元素为股票编号
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>设置基准</text>
                                                    <br />
                                                    <text class='infoCode'><b>set_benchmark(bm_code)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        bm_code为股票编号
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>设置初始现金</text>
                                                    <br />
                                                    <text class='infoCode'><b>set_startingCash(value)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        value是正整数
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>设置开始时间</text>
                                                    <br />
                                                    <text class='infoCode'><b>set_startDate(_datetime)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        _datetime为datetime类型，从1990~2016年
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>设置结束时间</text>
                                                    <br />
                                                    <text class='infoCode'><b>set_endDate(_datetime)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        _datetime为datetime类型，从1990~2016年
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>设置时间细度</text>
                                                    <br />
                                                    <text class='infoCode'><b>set_frequency(frequency)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        frequency为’day’或’min’，分别表示天级和分级
                                                    </text>
                                                </div>
                                                <br />
                                            </div>
                                            <br />
                                            <h1 class='infoType'>下订单</h1>
                                            <div id='order'>
                                                <div id=''>
                                                    <text class='infoHead'>按股数</text>
                                                    <br />
                                                    <text class='infoCode'><b>order(stock_name, amount)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        买卖股数为amount的股票
                                                        <br /> amount为正表示买，为负表示卖
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>按价格</text>
                                                    <br />
                                                    <text class='infoCode'><b>order_value(stock_name, value)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        买卖价格为value的股票
                                                        <br /> amount为正表示买，为负表示卖
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>按目标股数</text>
                                                    <br />
                                                    <text class='infoCode'><b>order_target(stock_name, amount)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        买卖股票使股数为amount
                                                    </text>
                                                </div>
                                                <br />
                                                <div id=''>
                                                    <text class='infoHead'>按目标价格</text>
                                                    <br />
                                                    <text class='infoCode'><b>order_target_value(stock_name, value)</b>
                                                        <br />
                                                    </text>
                                                    <text class='infoDetail'>
                                                        买卖股票使价格为value
                                                    </text>
                                                </div>
                                                <br />
                                            </div>
                                            <br />
                                        </div>
                                    </div>
                                    <!--  <div class="tab-pane" id="portlet_tab2_2">
                                            <p>
                                                Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo.
                                            </p>
                                            <p>
                                                <a class="btn red" href="ui_tabs_accordions.html#portlet_tab2_2" target="_blank">Activate this tab via URL</a>
                                            </p>
                                        </div> -->
                                    <!--  <div class="tab-pane" id="portlet_tab2_3">
                                            <p>
                                                Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi.
                                            </p>
                                            <p>
                                                <a class="btn purple" href="ui_tabs_accordions.html#portlet_tab2_3" target="_blank">Activate this tab via URL</a>
                                            </p>
                                        </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END TAB PORTLET-->
                </div>
                <div class="span6 pull-right" style="width: 50%;">
                    <!-- BEGIN PROGRESS BARS PORTLET-->
                    <div class="portlet box grey">
                        <div class="portlet-title">
                            <div class="caption"><i class="icon-cogs"></i>
                                <p class="algo-title" title="点击修改策略名称" style="width: 200px; margin-top: 1px; margin-bottom: 1px" id="pyName">这是一个示例策略</p>
                                <input class="algo-title-box hidden" id="title-box" value="这是一个示例策略" type="text" style="margin-top: 1px;margin-bottom: 1px; height: 10px; position: relative;">
                            </div>
                            <div class="tools">
                                <a href="javascript:;" class="collapse"></a>
                                <a href="#portlet-config" data-toggle="modal" class="config"></a>
                                <a href="javascript:;" class="reload" onclick="savePython()" title="保存策略"></a>
                                <!-- <a href="javascript:;" class="remove"></a> -->
                            </div>
                        </div>
                        <div class="portlet-body">
                            <!-- /widget-header -->
                            <div class="widget-content">
                                <div id="code" style="height: 511px; width: auto;">#-*- coding:UTF-8 -*-
import random
from glb import *
from config import Config
from datetime import timedelta,datetime
from function import *
import pandas as pd

def initialize(context,g):
    stocks = ['SH600000']
    set_universe(stocks)
    set_startDate(datetime(2014,1,1))
    set_endDate(datetime(2014,5,1))
    set_frequency('day')

    g.security = "SH600000"
    g.flag = False

# 双均线
def handle_data(context,o,g):
    n1 = 5
    n2 = 10
    security = g.security
    a = attribute_history(security, n2, '1d')
    if (a is None):
        return
    ma_n1 = a['end'][-n1:].astype('float').mean() # 计算5日均线
    ma_n2 = a['end'][-n2:].astype('float').mean() # 计算10日均线
    cash = context.portfolio.cash
    # 比较均线关系
    if (ma_n1 > ma_n2):  # 全买
        order = order_value(security, cash)
    else:# 全卖
        order = order_target(security, 0)
    return 0

def show_info(context,g):
    print '\norder'
    for i in Global.orderInfo:
        print i
    print 'totalValue,',totalValue()</div>
                                <script src="./js/src/ace.js" type="text/javascript" charset="utf-8"></script>
                                <script>
                                var editor = ace.edit("code");
                                editor.setTheme("ace/theme/monokai");
                                editor.getSession().setMode("ace/mode/python");
                                editor.getSession().setUseWrapMode(true);
                                var x = editor.getValue();
                                document.getElementById('code').style.fontSize = '16px';
                                console.log(x);
                                </script>
                                <!-- /shortcuts -->
                            </div>
                            <br>
                            <div style="right: 0"><a href="btest.php" class="btn blue" onclick="savePython()">运行回测 <i class="m-icon-swapright m-icon-white"></i></a></div>
                        </div>
                    </div>
                </div>
                <!-- END PAGE CONTENT-->
            </div>
            <!-- END PAGE CONTAINER-->
        </div>
        <!-- END PAGE -->
    </div>
    <!-- END CONTAINER -->
    <!-- BEGIN FOOTER -->
    <div class="footer">
        <div class="footer-inner">
            2013 &copy; Metronic by keenthemes.
        </div>
        <div class="footer-tools">
            <span class="go-top">

            <i class="icon-angle-up"></i>

            </span>
        </div>
    </div>
    <!-- END FOOTER -->
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
    <!-- BEGIN CORE PLUGINS -->
    <!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
    <script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
    <script src="media/js/bootstrap.min.js" type="text/javascript"></script>
    <!--[if lt IE 9]>

    <script src="media/js/excanvas.min.js"></script>

    <script src="media/js/respond.min.js"></script>

    <![endif]-->
    <script src="media/js/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="media/js/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="media/js/jquery.cookie.min.js" type="text/javascript"></script>
    <script src="media/js/jquery.uniform.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <script src="media/js/app.js"></script>
    <!--  <script>
    jQuery(document).ready(function() {

        App.init();

    });
    </script> -->
    <!-- END JAVASCRIPTS -->
    <!--  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37564768-1']);
    _gaq.push(['_setDomainName', 'keenthemes.com']);
    _gaq.push(['_setAllowLinker', true]);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
    </script> -->
</body>
<!-- END BODY -->

</html>
